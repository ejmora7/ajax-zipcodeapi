<!DOCTYPE html>
<html>
  <head>
    <title>
      AJAX|ZipCodeApi
    </title>
    <meta charset="UTF-8">  
    <style>
      	    html, body {
      	     	height: 100%;
      	    	 margin: 0;
      	    	 padding: 0;
      	   	  box-sizing: border-box;
      	    }
	    label {
	    	display:block;
	    }
      	    input {
       	   	 width: 100px;
       	   	 height: 20px;
      	    }
      	    .inputs {
      	     	 display: inline-block;
      	    	 margin-right: 30px;
      	    }
	    .statewidth {
	    	width: 33px;
	    }
    </style>
  </head>
  <body>
    <h1>
      What is the distance?
    </h1>
    <h4>By entering locations by zip code or city name the distance between the two will be shown.</h4>
    <p>Enter a location by city name.</p>
    <div id="form1">
      <div class="inputs">
        <label for="location1">Location 1</label>
        <input id="location1" type="text" placeholder="san diego">
        <input id="location1State" class="statewidth" type="text" placeholder="ca" maxlength="2">
      </div>
      <div class="inputs">
        <label for="location2">Location 2</label> 
        <input id="location2" type="text" placeholder="new york"> 
        <input id="location2State" class="statewidth" type="text" placeholder="ny" maxlength="2">
      </div>
      <div class="inputs">
        <input id="request" type="button" value="Get Distance"> 
      </div>	    
    </div> 
    <script type="text/javascript">
	    window.onload=()=>{
		    const loc1 = document.getElementById("location1");
		    const loc2 = document.getElementById("location2");
		    const loc1State = document.getElementById("location1State");
		    const loc2State = document.getElementById("location2State");
		    const req = document.getElementById("request");
		    let insertNode = ((refNode,newNode)=>{
			    refNode.appendChild(newNode);
		    });
		    
		    req.addEventListener("click",(e)=>{  
			    let L1Value = loc1.value;
			    let L1StateValue = loc1State.value; 
			    let L2Value = loc2.value;
			    let L2StateValue = loc2State.value;
			    let zipcode1,zipcode2;
			    L1Value.toLowerCase();
			    L1StateValue.toLowerCase();
			    L2Value.toLowerCase();
			    L2StateValue.toLowerCase();
			    
			    if(L1Value === "" || L2Value ===""){
				    console.log("they are empty");
			    }

			    let firstURL = "https://www.zipcodeapi.com/rest/js-ObvnGRv3w8HfHqoTQieXlpS2nWOHAeTs9mzanc0BPSTvMHffuTpTcexJ8KVzL7zS/city-zips.json/"+L1Value+"/"+L1StateValue;
			    let secondURL = "https://www.zipcodeapi.com/rest/js-ObvnGRv3w8HfHqoTQieXlpS2nWOHAeTs9mzanc0BPSTvMHffuTpTcexJ8KVzL7zS/city-zips.json/"+L2Value+"/"+L2StateValue;
			    function createRequest(url, cb) {
    				var xhr = new XMLHttpRequest();
    				xhr.open('GET', url);
    				xhr.onreadystatechange = function() {
					if(xhr.readyState === XMLHttpRequest.DONE){
    						if(xhr.status === 200){
    							cb(this.responseText);
    						}
   					}
    				};
    				xhr.send()
			    }
			    createRequest(firstURL, function(firstResponse) {
				
			    	let first = JSON.parse(firstResponse);
    				zipcode1 = first.zip_codes[0];
				//console.log(first.zip_codes[0]);
   				createRequest(secondURL, function(secondResponse) {
					let second = JSON.parse(secondResponse);
					zipcode2 = second.zip_codes[0];
					//console.log(second.zip_codes[0]);
    				});
			    });
			    console.log(zipcode1 +" "+ zipcode2);
		    });
	    };
    </script>  
  </body>
</html>
